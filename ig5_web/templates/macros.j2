{% macro _colored_city(school) -%}
  <span class="blue">{{ school.city }}</span>
{%- endmacro %}


{% macro _school_list(schools) %}
  <ul>
  {%- for school in schools %}
    <li>
      <a href="{{ school.url }}">{{ school.name|replace(school.city, _colored_city(school)) -}}</a>
    </li>
  {%- endfor %}
  </ul>
{%- endmacro %}


{% macro school_list_by_country(schools, year=none) %}
  {% set schools_grouped = {} %}

  {# Group schools by country. #}
  {% for school in schools.schools -%}
    {% if school.country not in schools_grouped -%}
      {% do schools_grouped.update({school.country: []}) -%}
    {% endif -%}

    {%- if year is not none and year|int not in school.attended -%}
    {%- else -%}
      {% do schools_grouped[school.country].append(school) -%}
    {%- endif -%}
  {% endfor %}

  {# Render schools by country. #}
  {# The order is 'sk', 'hu', 'cz' due to schools.json order #}
  {%- for country, schools in schools_grouped.items() -%}
    {% if schools %}
      {% if country == "sk" %}
      <h3>Slovensko</h3>
      {% elif country == "cz" %}
      <h3>Česko</h3>
      {% elif country == "hu" %}
      <h3>Maďarsko</h3>
      {% endif -%}
    {% endif -%}

    {{ _school_list(schools) }}
  {% endfor %}
{%- endmacro %}


{% macro school_count_by_year(schools, year) -%}
  {% set year = year|int %}
  {% set attended = namespace(count=0) %}

  {%- for school in schools.schools -%}
    {% if year in school.attended -%}
      {% set attended.count = attended.count + 1 -%}
    {% endif -%}
  {% endfor -%}

  {{ attended.count }}
{%- endmacro %}


{% macro sponsor_list_by_year(sponsors, year) %}
  {% set sponsors_grouped = [] %}

  {# Group sponsors by year. #}
  {% for sponsor in sponsors.sponsors -%}
    {%- if year|int in sponsor.supported -%}
      {% do sponsors_grouped.append(sponsor) -%}
    {%- endif -%}
  {% endfor %}

  {% if sponsors_grouped %}
    <p>Sponzori, vďaka ktorým sa súťaž mohla uskutočniť:</p>

    <div id="sponzoring">
      <ul class="sponzoring_text">
      {% for sponsor in sponsors_grouped|sort(attribute="name") %}
        {% if not sponsor.url %}
        <li>{{ sponsor.name }}</li>
        {% else %}
        <li>
          <a href="{{ sponsor.url }}">{{ sponsor.name }}</a>
        </li>
        {% endif %}
      {% endfor %}
      </ul>
    </div>
  {% endif %}
{%- endmacro %}


{% macro google_map() %}
  <div id="elevation_chart" style="position:absolute; z-index:0; margin-top:75px"></div>
  <div id="map_canvas" style="width: 100%; height:550px; position:relative"></div>
{%- endmacro %}


{% macro google_map_scripts(center, zoom, points, gmaps_api_key) %}
  <!-- Google maps -->
  <script type="text/javascript" src="https://www.google.com/jsapi"></script>
  <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key={{ gmaps_api_key }}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/maps.js')}}"></script>
  <script type="text/javascript" src="{{ url_for('static', filename='js/vendor/markerwithlabel.js')}}"></script>
  <script type="text/javascript">
    var center = new google.maps.LatLng({{ center }});
    var zoom = {{ zoom }};
    var points = {{ points }};

    $(document).ready(function() {
    		maps_initialize()
    });
  </script>
{%- endmacro %}


{% macro navigation_item(navigation_item, active_page) -%}
  {% set href = navigation_item[0] %}
  {% set id_ = navigation_item[1] %}
  {% set caption = navigation_item[2]|safe %}
  <a href="{{ href|e }}" title="{{ caption|e }}">
    <li {% if id_ == active_page -%}class="active"{% endif -%}>
      {{ caption|e }}
    </li>
  </a>
{%- endmacro %}


{% macro added_summary_href(year) -%}
  {{ "https://stavgeo" ~ url_for("summary", year=year) }}
{%- endmacro %}


{% macro photo_gallery(base_path, photos) -%}
<div class="gallery">
  {% for photo in photos %}
    <div class="thumbnail">
      {% set href_thumbnail = url_for("static", filename=base_path + "/thumbnails/" + photo) %}
      {% set href_photo = url_for("static", filename=base_path + "/images/" + photo) %}
      <a data-fancybox="images" class="thumbnailhover" rel="gallery" title="{{ photo }}" href="{{ href_photo }}">
        <img src="{{ href_thumbnail }}" title="{{ photo }}" alt="{{ photo }}" height="113">
      </a>
    </div>
  {% endfor %}
</div>
{%- endmacro %}
